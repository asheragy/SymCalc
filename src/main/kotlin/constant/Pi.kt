package org.cerion.symcalc.constant

import org.cerion.math.bignum.extensions.getPiToDigits
import org.cerion.symcalc.expression.ConstExpr
import org.cerion.symcalc.expression.Expr
import org.cerion.symcalc.number.RealBigDec
import org.cerion.symcalc.number.RealDouble

class Pi : ConstExpr() {
    override fun toString(): String = "Pi"
    override fun evaluateMachinePrecision() = RealDouble(Math.PI)

    override fun evaluateFixedPrecision(precision: Int): Expr {
        val storedPrecision = RealBigDec.getStoredPrecision(precision)
        if (storedPrecision < PI_DIGITS_1000.length) {
            val t = RealBigDec(PI_DIGITS_1000).toPrecision(storedPrecision) as RealBigDec
            return RealBigDec(t.value, precision)
        }

        return evalCompute(precision)
    }

    fun evalCompute(precision: Int) = RealBigDec(getPiToDigits(RealBigDec.getStoredPrecision(precision)), precision)

}

private const val PI_DIGITS_1000 = "3.14159265358979323846264338327950288419716939937510582097494459230781" +
        "6406286208998628034825342117067982148086513282306647093844609550582231" +
        "7253594081284811174502841027019385211055596446229489549303819644288109" +
        "7566593344612847564823378678316527120190914564856692346034861045432664" +
        "8213393607260249141273724587006606315588174881520920962829254091715364" +
        "3678925903600113305305488204665213841469519415116094330572703657595919" +
        "5309218611738193261179310511854807446237996274956735188575272489122793" +
        "8183011949129833673362440656643086021394946395224737190702179860943702" +
        "7705392171762931767523846748184676694051320005681271452635608277857713" +
        "4275778960917363717872146844090122495343014654958537105079227968925892" +
        "3542019956112129021960864034418159813629774771309960518707211349999998" +
        "3729780499510597317328160963185950244594553469083026425223082533446850" +
        "3526193118817101000313783875288658753320838142061717766914730359825349" +
        "0428755468731159562863882353787593751957781857780532171226806613001927" +
        "876611195909216420199"